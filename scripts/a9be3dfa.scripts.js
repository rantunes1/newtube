window.newtube=angular.module("newtube",["newtube.controllers","newtube.filters","newtube.services.oauth"]).value("version","1.0.0").run(["$window",function(a){"use strict";angular.element(a).on("unload",function(){})}]).config(["$httpProvider","$routeProvider",function(a,b){"use strict";a.defaults.useXDomain=!0,delete a.defaults.headers.common["X-Requested-With"],b.when("/subscriptions/",{templateUrl:"views/subscriptions.html"}).when("/channel/:channelId",{templateUrl:"views/channel.html"}).when("/playlist/:playlistId",{templateUrl:"views/playlist.html"}).when("/video/:videoId",{templateUrl:"views/video.html"}).when("/",{templateUrl:"views/search.html"}).otherwise({redirectTo:"/"})}]).factory("$exceptionHandler",["$log",function(a){"use strict";return function(b){a.error("exception: %o\n%o",b.message||b,b.stack||"<no stacktrace available>")}}]),angular.module("newtube.controllers",["newtube.plugins.lodash","newtube.services.oauth","newtube.services.youtube","newtube.services.updater","newtube.services.notifications","newtube.directives.textbox","newtube.directives.video-player","newtube.directives.video","newtube.directives.comments","newtube.directives.user-info","newtube.directives.app-link","ui.bootstrap.typeahead","template/typeahead/typeahead-match.html","template/typeahead/typeahead-popup.html"]).run(["$window","$rootScope",function(a,b){"use strict";b.windowWidth=a.outerWidth,angular.element(a).on("resize",function(){b.windowWidth=a.outerWidth,b.$apply("windowWidth")})}]).controller("AppCtrl",["_","$rootScope","$scope","$timeout","$log","OAuthService","NotificationsService","YTService","searchOptions",function(a,b,c,d,e,f,g,h,i){"use strict";e.log("CONTROLLER: App"),c.$watch("model.subscriptionsfeed.videos",function(a){e.info("videos : %o of %o",a?a.length:"<null>",c.model.user&&c.model.user.subscriptions?c.model.user.subscriptions.length:"<null>")}),c.model={subscriptionsfeed:{},playlistsfeed:{},sorters:[{label:"Date published",sort:function(a){return a.published}},{label:"Title",sort:function(a){return h.getVideoTitle(a).toLowerCase()}},{label:"Duration",sort:function(a){return~~a.duration}},{label:"Channel",sort:h.getVideoAuthor},{label:"Likes",sort:function(a){return~~(a.ratings.numLikes||0)||("desc"===c.model.sorter.direction?0:Number.MAX_VALUE)}},{label:"Views",sort:function(a){return~~(a.ratings.viewCount||0)||("desc"===c.model.sorter.direction?0:Number.MAX_VALUE)}},{label:"Comments",sort:function(a){var b=a.comments?~~(a.comments.count||0):0;return b||("desc"===c.model.sorter.direction?0:Number.MAX_VALUE)}}]},c.model.sorter={active:c.model.sorters[0],direction:"desc",isAscending:function(){return"desc"!==this.direction},changeDirection:function(){this.direction=this.isAscending()?"desc":"",this.sort(this.active)},sort:function(b,d){b?this.active=b:b=this.active;var e=a.sortBy(d||c.model.subscriptionsfeed.videos,b.sort);return e=this.isAscending()?e:e.reverse(),d?e:(c.model.subscriptionsfeed.videos=e,void 0)}},c.model.searchResults=null,c.model.searchOptions=i,c.model.query={orderby:i.orderby[0],safeSearch:i.safeSearch[0],time:i.time[1],lr:"pt"},c.auth=f,c.model.showUserInfo=function(){c.model.user&&(c.model.userInfoVisible=!0)},c.model.hideUserInfo=function(){c.model.userInfoVisible=!1},b.$on("user.not.authenticated",function(){c.model.accessToken=null,c.model.user=null}),b.$watch("windowWidth",function(a){e.log("window resized to ",a)});var j=function(b){c.model.user=b,e.log("[APP user] [%o]",b);var f,i=function(b){e.info("notifications %o",b),c.model.notifications=b,a.each(b,function(a){d(function(){e.log("showing notification ",a),g.info("notification :"+a.title)})}),j()},j=function(){f=d(function(){h.getNotifications().then(i,function(a){e.error("unable to get notifications - %o : %o ",a.name,a.message)})},c.model.notifications?6e4:0)};j()};c.$watch(f.isAuthenticated,function(a,b){e.log("APP: Token: %o --> %o",b,a),c.model.accessToken=a,a&&h.getCurrentUser().then(j)})}]).controller("SearchCtrl",["_","$scope","$routeParams","YTService","$log",function(a,b,c,d,e){"use strict";e.log("CONTROLLER: Search"),b.model.search=function(){var c={};a.each(b.model.query,function(b,d){b&&(b.value?c[d]=b.value:a.isString(b)&&(c[d]=b))}),d.searchVideos(c).then(function(a){e.info("received search results %o",a),b.model.searchResults=a})}}]).controller("ChannelCtrl",["$scope","$routeParams","YTService","$log",function(a,b,c,d){"use strict";d.log("CONTROLLER: Channel");var e=b.channelId;c.getChannel(e).then(function(b){d.info("received channel data %o",b),a.model.channel=b})}]).controller("PlaylistCtrl",["_","$scope","$routeParams","$timeout","YTService","$log",function(a,b,c,d,e,f){"use strict";f.log("CONTROLLER: Playlist"),b.model=b.model||{},b.model.playlist={},b.model.viewer="carousel",b.model.changeViewer=function(){this.viewer="grid"===this.viewer?"carousel":"grid"};var g=c.playlistId;e.getPlaylist(g).then(function(a){f.info("received playlist",a),b.model.playlist=a})}]).controller("VideoCtrl",["$scope","$routeParams","YTService","$log",function(a,b,c,d){"use strict";d.log("CONTROLLER: Video");var e=b.videoId;c.getVideo(e).then(function(b){d.info("received video data %o",b),a.model.video=b,a.model.playingVideoId=e}),c.loadVideoComments(e).then(function(b){d.info("received video comments %o",b),b.comments=b.comments||[],a.model.commentsData=b})}]).controller("SubscriptionsCtrl",["_","$scope","$timeout","OAuthService","YTService","UpdateService","$log",function(a,b,c,d,e,f,g){"use strict";g.log("CONTROLLER: Subscriptions");var h=function(h){if(h){var i=function(a){return(a||"").replace(/[\'\'\-\_\(\)\{\}\[\]\/\?\*\^\+\~&%$#! ]/g,"").trim().toLowerCase()};g.info("[SUBSCRIPTIONS] [registering listener]"),new f({compareAttribute:"published",savedItems:function(){return h.subscriptions},fetchItems:e.getUserSubscriptions,processItems:function(c,e){h.subscriptions=a.clone(e,!0),d.updateUser(h),b.model.subscriptionsfeed.videos=e,b.model.filters.apply()}}),e.getUserPlaylists().then(function(c){c.playlists=a.sortBy(c.playlists,function(a){return-1*a.updated.valueOf()}),b.model.playlistsfeed=c,g.warn("got playlists ",b.model.playlistsfeed)},function(a){g.error("unable to get playlists - %o : %o ",a.name,a.message)});var j=h.likes;j||e.getUserLikes().then(function(a){h.likes=a,d.updateUser(h),g.warn("got likes ",h.likes)},function(a){g.error("unable to get likes - %o : %o ",a.name,a.message)}),b.model.filters={running:!1,apply:function(){if(this.running!==!0){this.running=!0;var d=h.subscriptions;if(!d||!d.length)return this.running=!1,void 0;d=a.clone(d,!0),a.forEach(this,function(b){d=a.isPlainObject(b)&&b.apply?b.apply(d):d}),d.length>1&&(d=b.model.sorter.sort(null,d));var e=this;c(function(){b.$apply(function(){b.model.subscriptionsfeed.videos=d,e.running=!1})})}},hidden:{apply:function(b){return a.filter(b,function(a){return this.value===!0||a.hidden!==!0},this)}},watched:{apply:function(b){return a.filter(b,function(a){return this.value===!0||a.watched!==!0},this)}},liked:{value:!0,apply:function(b){return a.filter(b,function(a){return this.value===!0||a.liked!==!0},this)}},channel:{apply:function(b){return a.filter(b,function(a){return!this.value||e.getVideoAuthor(a).match(this.value)},this)}},title:{apply:function(b){return a.filter(b,function(a){return!this.value||i(e.getVideoTitle(a)).match(i(this.value))},this)}}},b.model.getSubscriptionChannels=function(){var b=a.uniq(a.map(h.subscriptions,e.getVideoAuthor)),c=a.sortBy(b,function(a){return a.toLowerCase()});return c},b.model.getVideoTitles=function(){var b=a.uniq(a.map(h.subscriptions,e.getVideoTitle)),c=a.sortBy(b,function(a){return a.toLowerCase()});return c},b.model.showVideo=function(b){a.where(h.subscriptions,{id:b})[0].hidden=!1,d.updateUser(h),this.filters.apply()},b.model.hideVideo=function(b){a.where(h.subscriptions,{id:b})[0].hidden=!0,d.updateUser(h),this.filters.apply()},b.model.likeVideo=function(b){a.where(h.subscriptions,{id:b})[0].liked=!0,d.updateUser(h),this.filters.apply()},b.model.unlikeVideo=function(b){a.where(h.subscriptions,{id:b})[0].liked=!1,d.updateUser(h),this.filters.apply()},b.model.markVideoWatched=function(b){a.where(h.subscriptions,{id:b})[0].watched=!0,d.updateUser(h),this.filters.apply()},b.model.watchLater=function(){},b.model.unsubscribe=function(){},b.$watch("model.filters.channel.value",function(a,c){c&&!(a||"").trim()&&b.model.filters.apply()}),b.$watch("model.filters.title.value",b.model.filters.apply),b.$watch("model.filters.hidden.value",b.model.filters.apply),b.$watch("model.filters.watched.value",b.model.filters.apply),b.$watch("model.filters.liked.value",b.model.filters.apply)}};b.$watch("model.user",h)}]).constant("searchOptions",{caption:[{text:"only with captions",value:"true"},{text:"only without captions",value:"false"}],duration:[{text:"short",value:"short"},{text:"medium",value:"medium"},{text:"long",value:"long"}],license:[{text:"Creative Commons",value:"cc"},{text:"Youtube standard",value:"youtube"}],orderby:[{text:"Relevance",value:"relevance"},{text:"Date published",value:"published"},{text:"Views",value:"viewCount"},{text:"Ratings",value:"rating"}],safeSearch:[{text:"Disabled",value:"none"},{text:"Moderate",value:"moderate",isDefault:!0},{text:"Strict",value:"strict"}],time:[{text:"All time",value:"all_time"},{text:"Today",value:"today"},{text:"This week",value:"this_week"},{text:"This month",value:"this_month"}],category:[{text:"Film & Animation",value:"Film"},{text:"Autos & Vehicles",value:"Autos"},{text:"Music",value:"Music"},{text:"Pets & Animals",value:"Animals"},{text:"Sports",value:"Sports"},{text:"Travel & Events",value:"Travel"},{text:"Gaming",value:"Games"},{text:"Videoblogging",value:"Videoblog"},{text:"People & Blogs",value:"People"},{text:"Comedy",value:"Comedy"},{text:"Entertainment",value:"Entertainment"},{text:"News & Politics",value:"News"},{text:"Howto & Style",value:"Howto"},{text:"Education",value:"Education"},{text:"Science &Technology",value:"Tech"}],lr:{af:{name:"Afrikaans",nativeName:"Afrikaans"},am:{name:"Amharic",nativeName:"አማርኛ"},ar:{name:"Arabic",nativeName:"العربية"},eu:{name:"Basque",nativeName:"euskara, euskera"},bn:{name:"Bengali",nativeName:"বাংলা"},bg:{name:"Bulgarian",nativeName:"български език"},ca:{name:"Catalan; Valencian",nativeName:"Català"},zh:{name:"Chinese",nativeName:"中文 (Zhōngwén), 汉语, 漢語"},hr:{name:"Croatian",nativeName:"hrvatski"},cs:{name:"Czech",nativeName:"česky, čeština"},da:{name:"Danish",nativeName:"dansk"},nl:{name:"Dutch",nativeName:"Nederlands, Vlaams"},en:{name:"English",nativeName:"English"},et:{name:"Estonian",nativeName:"eesti, eesti keel"},fi:{name:"Finnish",nativeName:"suomi, suomen kieli"},fr:{name:"French",nativeName:"français, langue française"},gl:{name:"Galician",nativeName:"Galego"},de:{name:"German",nativeName:"Deutsch"},el:{name:"Greek",nativeName:"Ελληνικά"},he:{name:"Hebrew (modern)",nativeName:"עברית"},hi:{name:"Hindi",nativeName:"हिन्दी, हिंदी"},hu:{name:"Hungarian",nativeName:"Magyar"},id:{name:"Indonesian",nativeName:"Bahasa Indonesia"},is:{name:"Icelandic",nativeName:"Íslenska"},it:{name:"Italian",nativeName:"Italiano"},ja:{name:"Japanese",nativeName:"日本語 (にほんご／にっぽんご)"},ko:{name:"Korean",nativeName:"한국어 (韓國語), 조선말 (朝鮮語)"},lt:{name:"Lithuanian",nativeName:"lietuvių kalba"},lv:{name:"Latvian",nativeName:"latviešu valoda"},ms:{name:"Malay",nativeName:"bahasa Melayu"},mr:{name:"Marathi",nativeName:"मराठी"},nb:{name:"Norwegian Bokmål",nativeName:"Norsk bokmål"},fa:{name:"Persian",nativeName:"فارسی"},pl:{name:"Polish",nativeName:"polski"},pt:{name:"Portuguese",nativeName:"Português"},ro:{name:"Romanian, Moldavian, Moldovan",nativeName:"română"},ru:{name:"Russian",nativeName:"русский язык"},sr:{name:"Serbian",nativeName:"српски језик"},sk:{name:"Slovak",nativeName:"slovenčina"},sl:{name:"Slovene",nativeName:"slovenščina"},es:{name:"Spanish; Castilian",nativeName:"español, castellano"},sw:{name:"Swahili",nativeName:"Kiswahili"},sv:{name:"Swedish",nativeName:"svenska"},ta:{name:"Tamil",nativeName:"தமிழ்"},th:{name:"Thai",nativeName:"ไทย"},uk:{name:"Ukrainian",nativeName:"українська"},ur:{name:"Urdu",nativeName:"اردو"},vi:{name:"Vietnamese",nativeName:"Tiếng Việt"},zu:{name:"Zulu",nativeName:""}}}),angular.module("newtube.plugins.d3",[]).run(["$window",function(a){"use strict";if(!a.d3)throw new Error("missing <d3.js>")}]).factory("D3",["$window",function(a){"use strict";return a.d3}]),angular.module("newtube.plugins.lodash",[]).run(["$window",function(a){"use strict";if(!a._)throw new Error("missing <lodash.js>")}]).factory("_",["$window",function(a){"use strict";return a._}]),angular.module("newtube.plugins.lz-string",[,"newtube.plugins.lodash"]).run(["$window",function(a){"use strict";if(!a.LZString)throw new Error("missing <lz-string.js>")}]).factory("LZString",["$window","_",function(a,b){"use strict";var c=function(d,e){if(!d)return d;var f=new Date(d);e=e||b.noop;var g=null;return b.isArray(d)?(g=[],b.forEach(d,function(a){g.push(c(a,e))})):b.isNumber(d)||b.isBoolean(d)?g=d:a.isNaN(f)||JSON.stringify(d).replace(/\"/g,"")!==f.toISOString()?b.isString(d)?g=e(d):b.isObject(d)&&(g={},b.forEach(d,function(a,b){g[b]=c(a,e)})):g=new Date(d),g||d},d=function(b){return c(b,a.LZString.compressToUTF16)},e=function(b){return c(b,a.LZString.decompressFromUTF16)};return{compress:d,decompress:e}}]),angular.module("newtube.plugins.moment",[]).run(["$window",function(a){"use strict";if(!a.moment)throw new Error("missing <moment.js>")}]).factory("moment",["$window",function(a){"use strict";return a.moment}]),angular.module("newtube.plugins.owl-carousel",[]).run([function(){"use strict";if(!angular.element().owlCarousel)throw new Error("missing <owl.carousel.js>")}]).factory("owl-carousel",[function(){"use strict";return function(a,b){a.owlCarousel(b)}}]),angular.module("newtube.plugins.store",[]).run(["$window",function(a){"use strict";if(!a.store)throw new Error("missing <store.js>")}]).factory("store",["$window",function(a){"use strict";return a.store}]),angular.module("newtube.plugins.tip",["newtube.plugins.lodash"]).run([function(){"use strict";if(!angular.element().qtip)throw new Error("missing <jquery.qtip.js>")}]).factory("tip",["_","$window",function(a,b){"use strict";var c=angular.element(b),d={content:{text:"",title:""},style:{def:!1,classes:"qtip-rounded qtip-tipsy",tip:{corner:"center left",border:1}},position:{my:"top left",at:"center right",viewport:c,adjust:{method:"flip shift"}},show:{delay:300,solo:!0},hide:{fixed:!0,delay:100}},e=function(a,b){b=b||{};var c=angular.extend({},d.position||{},{target:a}),e=angular.extend({},d.events||{},{show:function(b,c){var d=a.attr("title");if(d){var e=null;try{e=angular.element(d)}catch(f){}e&&e.length||!angular.isString(d)||(e=d);var g=angular.element("#viewport");g&&g.length&&c.set("position.viewport",g),c.set("content.text",e||d)}}}),f=angular.extend(d,{position:c,events:e}),g=angular.extend({},f,b);return a.qtip(g)};return function(a,b){return{show:function(){return e(a,b)},remove:function(){return a.qtip("destroy")},refresh:function(){return a.qtip("reposition")},hide:function(){return a.qtip("hide")}}}}]),angular.module("newtube.plugins.toastr",[]).run(["$window",function(a){"use strict";if(!a.toastr)throw new Error("missing <toastr.js>")}]).factory("toastr",["$window",function(a){"use strict";return a.toastr}]),angular.module("newtube.plugins.videojs-youtube",[]).run(["$window",function(a){"use strict";if(!a.videojs)throw new Error("missing <video.js>");if(!a.videojs.Youtube)throw new Error("missing <videojs-youtube.js>")}]).factory("videojs-youtube",["$window",function(a){"use strict";return function(b,c){return a.videojs(b.get(0),c)}}]),angular.module("newtube.services.cache",["newtube.plugins.store","newtube.plugins.lz-string"]).factory("CacheService",["$window","$cacheFactory","$log","store","LZString",function(a,b,c,d,e){"use strict";var f=b("CACHE_SERVICE",{capacity:5}),g={};angular.element(a).on("unload",function(){d.setAll(g)});var h=function(a,b){var c=b,g=!1;return a&&(a=a.toString(),c=f.get(a),c||(c=d.get(a),c=e.decompress(c),g=!0,c&&f.put(a,c))),c},i=function(a,b,i){if(i=angular.extend({},{keepExisting:!1,"transient":!1,getKey:function(a,b){return(a||b||"").toString()}},i),b){if(a=i.getKey(a,b),i.keepExisting===!0){var j=h(a);if(j)return c.log("CACHE: abort [%o] : %o",a,j),j}f.put(a,b),i.transient!==!0&&(g[a]=e.compress(b))}else a&&(a=a.toString(),delete g[a],f.remove(a.toString()),i.transient!==!0&&d.has(a)?(d.remove(a),c.log("STORE: removed [%o]",a)):c.log("CACHE: removed [%o]",a));return b},j=function(a,b){i(a,null,b)};return{put:i,get:h,remove:j}}]),angular.module("newtube.services.config",["newtube.plugins.lodash"]).constant("INVALID_TOKEN","_invalid_").constant("providers",[{id:"google",name:"Google API",api:{youtube:{key:"AIzaSyALsHXjizSWKj04T3FTRUZhHHM1RXvhoZk"}},oauth:{client_id:"453427542929.apps.googleusercontent.com",redirect_uri:"http://rantunes1.github.io/newtube/oauth2callback.html",response_type:"token",url:"https://accounts.google.com/o/oauth2/auth",scope:["https://www.googleapis.com/auth/youtube","https://www.googleapis.com/auth/youtube.readonly"].join(" "),approval_prompt:"auto",state:null,login_hint:null},verification:{url:"https://www.googleapis.com/oauth2/v1/tokeninfo",tokenParam:"access_token",checkField:"client_id"}}]).factory("ConfigService",["_","providers","INVALID_TOKEN",function(a,b,c){"use strict";var d={providers:{}};if(a.each(b,function(a){d.providers[a.id||c]=a}),d.providers[c])throw new Error("CONFIG: provider has no id attribute ");var e=function(a){return a?d.providers[a]:null},f=function(a,b){if(!a||!b)return null;var c=e(a),d=c?c[b]:null;return{get:function(a,b){var c=d&&a?d[a]:null;if(b&&!c)throw new Error("CONFIG: missing required parameter  : "+a);return c},getAll:function(){return d}}};return{getOAuthConfig:function(a){return f(a,"oauth")},getAuthVerification:function(a){return f(a,"verification")},getApiKey:function(a,b){var c=e(a);if(!c||!b)return null;var d=c.api[b];return d.key}}}]),angular.module("newtube.services.notifications",["newtube.plugins.toastr"]).factory("NotificationsService",["$log","toastr",function(a,b){"use strict";return{info:function(a){b.info(a)}}}]),angular.module("newtube.services.oauth",["newtube.plugins.lodash","newtube.services.config","newtube.services.cache"]).factory("OAuthService",["_","$window","$http","$q","$rootScope","$log","ConfigService","CacheService",function(a,b,c,d,e,f,g,h){"use strict";var i="#invalid#",j="google",k=function(b){var c=[];return a.each(b,function(a,b){c.push(encodeURIComponent(b)+"="+encodeURIComponent(a))}),c.join("&")},l=function(a,b){if(f.log("OAUTH: saving oauth token ",a),a){var d=g.getAuthVerification(j),i=d?d.get("url"):null,k=d?d.get("tokenParam"):null,l=a[k];if(i){var m={method:"get",url:i};k&&(m.params={},m.params[k]=l),e.$apply(function(){c(m).then(function(a){var c=a.data;f.log("OAUTH: verification response : ",c);var e=d?d.get("checkField"):null;b.get(e)===c.audience&&(delete c.audience,h.put("ua",{token:l,verification:c}))},function(a){f.error("OAUTH: error : ",a)})})}else h.put("ua",{token:l?l:k?d.get(k):a})}},m=function(){h.put("ua",i);var a=g.getOAuthConfig(j);if(!a)return f.warn("OAUTH: no oauth configuration."),null;var c=a.get("url"),d=angular.extend({},a.getAll());delete d.url,c+="?"+k(d);var e=b.open(c,"authentication","width=650,height=300,resizable=yes,scrollbars=yes,status=yes");return angular.element(b).on("message",function(b){b=b.originalEvent||b,b.source===e&&b.origin===window.location.origin&&l(b.data,a)}),null},n=function(){h.remove("ua")},o=function(){return h.get("ua")},p=function(a){h.put(s(),a)},q=function(){var a=o();return a&&a.token&&a!==i?a.token:null},r=function(){return angular.isString(q())},s=function(){var a=o();if(!a)throw new Error("can not set an unauthenticated user");if(!a.verification)throw new Error("current user token was not validated");var b="issued_to";if(!a.verification[b])throw new Error("unable to match the user with an access token");return a.verification[b]},t=function(){return r()?h.get(s()):null};return{isAuthenticated:r,getAccessToken:q,getUser:t,updateUser:p,authenticate:m,logout:n}}]).controller("CallbackCtrl",["_","$scope","$location",function(a,b,c){"use strict";var d=function(b){var c,d,e={};return a.each((b||"").split("&"),function(a){a&&(c=a.split("="),d=decodeURIComponent(c[0]),e[d]=angular.isDefined(c[1])?decodeURIComponent(c[1]):!0)}),e},e=c.path().substring(1),f=d(e);window.opener.postMessage(f,"*"),window.close()}]),angular.module("newtube.services.updater",[]).factory("UpdateService",["_","$http","$timeout","$log",function(a,b,c,d){"use strict";var e={maxResults:50,idAttribute:"id",compareAttribute:"id",items:[],eventsInterval:3e5,savedItems:angular.noop,fetchItems:angular.noop,searchIndex:1},f=function(a){a=a||1;var b=a>e.searchIndex;e.searchIndex=a,b&&h()},g=function(b){var g=b.videos,i=b.search;d.warn("received webItems : ",g);var j=[],k=e.savedItems()||[],l=!1;if(k.length){var m=a.max(k,e.compareAttribute),n=m?m[e.idAttribute]:null;n&&a.forEach(g,function(a){return a[e.idAttribute]===n?(l=!0,!1):(j.push(a),void 0)})}else j=g;if(!l&&i){var o=i.numItems+e.searchIndex;o>i.totalItems&&(o=1),f(o)}else h(e.eventsInterval);var p=a.sortBy(a.uniq(k.concat(j),!1,e.idAttribute),e.compareAttribute).reverse();c(function(){e.processItems(a.clone(j,!0),p,b)},0)},h=function(a){var b=c(function(){e.fetchItems({searchIndex:e.searchIndex,maxResults:e.maxResults}).then(function(a){g(a.data)},function(a){d.error("unable to get items - %o : %o ",a.name,a.message),c.cancel(b)})},a||0)};return function(b){e=a.extend({},e,b),h()}}]),angular.module("newtube.services.youtube",["newtube.services.config","newtube.services.oauth","newtube.services.yt-parser","newtube.plugins.lodash"]).config(["$httpProvider","YTParserProvider",function(a,b){"use strict";var c=function(a){if(!angular.isObject(a))return a;a.data&&(a=a.data);var c=a.kind,d=a.items,e=b.getV3ParserFor(c);if(e)return e(d,a.prevPageToken,a.nextPageToken);var f=a.feed,g=a.entry;if(!angular.isObject(f))return angular.isObject(g)?(e=b.getUserParser(),e(g)):a;var h={title:f.title?f.title.$t||"":"",updated:new Date(f.updated.$t),links:f.link,search:{numItems:f.openSearch$itemsPerPage.$t,startIndex:f.openSearch$startIndex?f.openSearch$startIndex.$t||1:1,totalItems:f.openSearch$totalResults.$t}},i=f.category[0].term;return g=f.entry,e=b.getV2ParserFor(i),e(h,g)||f};a.defaults.transformResponse.push(c);var d=["$rootScope","$q",function(a,b){var c=function(a){return a},d=function(c){if(401===c.status){var d=b.defer();return a.$broadcast("user.not.authenticated"),d.promise}return a.error=c.status,b.reject(c)};return function(a){return a.then(c,d)}}];a.responseInterceptors.push(d)}]).factory("YTService",["_","$http","$q","$timeout","$log","ConfigService","OAuthService",function(a,b,c,d,e,f,g){"use strict";var h=function(a){return{headers:{Authorization:"Bearer "+g.getAccessToken(),"GData-Version":"2","X-GData-Key":"key="+f.getApiKey("google","youtube")},params:angular.extend({alt:"json"},a||{})}},i=function(a){return a&&a.author?a.author.name||"":""},j=function(a){return a?(a.title||"").toString():""},k=function(){var a=c.defer(),d=g.getUser();return d?a.resolve(d):b(angular.extend({},h(),{url:"https://gdata.youtube.com/feeds/api/users/default",method:"get"})).then(function(b){var c=b.data;g.updateUser(c),a.resolve(c)},a.reject),a.promise},l=function(a){return b(angular.extend({},h({"start-index":a.searchIndex,"max-results":a.maxResults}),{url:"https://gdata.youtube.com/feeds/api/users/default/newsubscriptionvideos",method:"get"}))},m=function(a){var d=c.defer();return b(angular.extend({},h({"max-results":50,orderby:"published",prettyprint:!0}),{url:"https://gdata.youtube.com/feeds/api/videos/"+a+"/comments",method:"get"})).then(function(b){var c=b.data;e.warn("received comments for video %o : %o",a,c),d.resolve(c)},d.reject),d.promise},n=function(){var a=c.defer(),d=function(c){var d=c.playlists;d?a.resolve(d):b(angular.extend({},h({"max-results":50}),{url:"https://gdata.youtube.com/feeds/api/users/default/playlists",method:"get"})).then(function(b){var d=b.data;e.warn("received playlists : ",d),c.playlists=d,g.updateUser(c),a.resolve(d)},a.reject)};return k().then(d),a.promise},o=function(){var a=c.defer(),d=function(c){b(angular.extend({},h({"max-results":50}),{url:"https://gdata.youtube.com/feeds/api/users/default/friendsactivity",method:"get"})).then(function(b){var d=(b.data||{}).events||[],e=c.notifications;if(0!==d.length){if(!e)return c.notifications=d.reverse(),g.updateUser(c),a.resolve([d.pop()]),void 0;for(var f=e[e.length-1],h=[];d.length;){var i=d.pop();i.id===f.id&&(h=d,d=[])}c.notifications=e.concat(h),g.updateUser(c),a.resolve(h)}else a.resolve([])},a.reject)};return k().then(d),a.promise},p=function(a){var d=c.defer();return a=/^UC/.test(a)?a:"UC"+a,b(angular.extend({},h({part:"id,snippet,contentDetails,statistics,topicDetails,invideoPromotion",id:a}),{url:"https://www.googleapis.com/youtube/v3/channels",method:"get"})).then(function(a){var b=a.data;e.warn("received channel : ",b),d.resolve(b)},d.reject),d.promise},q=function(d){var f=c.defer();return b(angular.extend({},h({"max-results":50}),{url:"https://gdata.youtube.com/feeds/api/playlists/"+d,method:"get"})).then(function(c){var g=c.data;e.warn("received playlist v2: ",g),b(angular.extend({},h({part:"snippet,status",id:d}),{url:"https://www.googleapis.com/youtube/v3/playlists",method:"get"})).then(function(c){var d=c.data;e.warn("received playlist v3: ",d);var i=angular.extend({},g,d);b(angular.extend({},h({part:"id,snippet,contentDetails,statistics,status",maxResults:50,id:a.pluck(i.videos,"id").join(",")}),{url:"https://www.googleapis.com/youtube/v3/videos",method:"get"})).then(function(b){var c=b.data;e.warn("received videosList : ",c);var d=[];a.each(i.videos,function(b){var e=a.where(c,{id:b.id})[0];e&&delete e.thumbnails,d.push(angular.extend({},b,e,!0))}),i.videos=d,f.resolve(i)},f.reject)},f.reject)},f.reject),f.promise},r=function(){var a=c.defer(),b=function(b){var c=b.channel;c?a.resolve(c):p(b.channelId).then(function(a){b.channel=a,g.updateUser(b)},a.reject)};return k().then(b),a.promise},s=function(d){var f=c.defer(),g=[],i=function(c,d,i){var k=a.pluck(i.items,"videoId");b(angular.extend({},h({part:"id,snippet,contentDetails,statistics,status",maxResults:50,id:k.join(",")}),{url:"https://www.googleapis.com/youtube/v3/videos",method:"get"})).then(function(b){var f=b.data;e.warn("received videosList : ",f),a.each(i.items,function(b){b.video=a.where(f,{id:b.videoId})[0],g.push(b)}),j(c,i.nextPage!==d?i.nextPage:null)},f.reject)},j=function(a,c){return g.length&&!c?(f.resolve(g),void 0):g.length>=100?(f.resolve(g),void 0):(b(angular.extend({},h({part:"id, snippet,contentDetails,status",maxResults:50,playlistId:a,pageToken:c}),{url:"https://www.googleapis.com/youtube/v3/playlistItems",method:"get"})).then(function(b){var d=b.data;e.warn("received playlistVideos : ",d),i(a,c,d)},f.reject),void 0)};return j(d),f.promise},t=function(){var a=c.defer();return r().then(function(b){var c=b.specialPlaylists.likes;c?s(c).then(a.resolve):a.reject("unknown likes videos channel")}),a.promise},u=function(a){var d=c.defer();return b(angular.extend({},h({part:"snippet,contentDetails,liveStreamingDetails,statistics,status,topicDetails",id:a,maxResults:1}),{url:"https://www.googleapis.com/youtube/v3/videos",method:"get"})).then(function(a){d.resolve(a.data[0])},d.reject),d.promise},v=function(a,d){a=angular.extend({},a||{},{stict:!0,"start-index":d||1,"max-results":50});var e=c.defer();return b(angular.extend({},h(a),{url:"https://gdata.youtube.com/feeds/api/videos",method:"get"})).then(function(a){e.resolve(a.data)},e.reject),e.promise},w=function(){throw"not implemented"};return{getCurrentUser:k,searchVideos:v,getVideo:u,getVideos:w,getVideoTitle:j,getVideoAuthor:i,getChannel:p,getPlaylist:q,getPlaylistVideos:s,loadVideoComments:m,getUserSubscriptions:l,getUserPlaylists:n,getNotifications:o,getUserLikes:t}}]),angular.module("newtube.services.yt-parser",["newtube.plugins.lodash"]).provider("YTParser",[function(){"use strict";var a=window._,b=function(b){var c=a.map(b||"",function(a){var b=a.charCodeAt(0);return 10===b||13===b?"<br/>":a}).join(""),d=c.match(/([^\]\/">]|^)((https?):\/\/[-A-ZÅÄÖ0-9+&@#\/%?=~_|!:,.;]*[-A-ZÅÄÖ0-9+&@#\/%=~_|])/gi);return a.each(d,function(a){var b='&nbsp;<a target="ytlink" href="'+a+'">'+a+"</a>";c=c.replace(a,b)}),c};this.$get=[function(){throw new Error("YTParser cannot be instantiated")}],this.getUserParser=function(){var b=function(b){var c={};return a.each(b.gd$feedLink||[],function(a){var b=a.rel||"",d=b.substring(b.lastIndexOf(".")+1).toLowerCase();c[d]={url:a.href,count:a.countHint}}),{id:b.yt$userId.$t,gplusId:b.yt$googlePlusUserId?b.yt$googlePlusUserId.$t:null,channelId:b.yt$channelId.$t,title:b.title.$t,created:b.published?new Date(b.published.$t):null,lastChanged:b.updated?new Date(b.updated.$t):null,aboutMe:b.yt$aboutMe?b.yt$aboutMe.$t:null,age:b.yt$age?b.yt$age.$t:null,books:b.yt$books?b.yt$books.$t:null,company:b.yt$company?b.yt$company.$t:null,firstName:b.firstName?b.firstName.$t:null,gender:b.yt$gender?b.yt$gender.$t:null,hobbies:b.yt$hobbies?b.yt$hobbies.$t:null,hometown:b.yt$hometown?b.yt$hometown.$t:null,lastName:b.lastName?b.lastName.$t:null,location:b.yt$location?b.yt$location.$t:null,maxUploadDuration:b.yt$maxUploadDuration?b.yt$maxUploadDuration.$t:null,movies:b.yt$movies?b.yt$movies.$t:null,music:b.yt$music?b.yt$music.$t:null,occupation:b.yt$occupation?b.yt$occupation.$t:null,school:b.yt$school?b.yt$school.$t:null,username:b.yt$username.$t,displayName:b.yt$username.display,statistics:{watched:b.yt$statistics?~~(b.yt$statistics.videoWatchCount||0):null,subscribers:b.yt$statistics?~~(b.yt$statistics.subscriberCount||0):null,favorited:b.yt$statistics?~~(b.yt$statistics.favoriteCount||0):null,views:b.yt$statistics?~~(b.yt$statistics.totalUploadViews||0):null},thumbnail:b.media$thumbnail?b.media$thumbnail.url:null,feeds:c}};return b},this.getV2ParserFor=function(a){return/video$/.test(a)||/playlist$/.test(a)?c.videoListParser:/userEvent$/.test(a)?c.userEventsParser:/playlistLink$/.test(a)?c.playlistParser:/comment$/.test(a)?c.commentsParser:null},this.getV3ParserFor=function(a){return/channelListResponse$/.test(a)?d.channelParser:/subscriptionListResponse$/.test(a)?null:/activityListResponse$/.test(a)?null:/playlistItemListResponse$/.test(a)?d.playlistItemParser:/playlistListResponse$/.test(a)?d.playlistParser:/videoCategoryListResponse$/.test(a)?null:/videoListResponse$/.test(a)?d.videoListParser:void 0};var c=function(){var c=function(c,d){var e=[];return a.each(d||[],function(c){var d={};a.each(c.yt$accessControl,function(a){d[a.action]=a.permission});var f=c.author[0],g=c.media$group,h=g.media$thumbnail,i=null;if("denied"!==d.comment){var j=c.gd$comments?c.gd$comments.gd$feedLink||{}:{};i={feed:j.href,count:j.countHint}}var k={};a.each(h,function(a){var b=a.yt$name;delete a.yt$name,k[b]=a}),c.yt$rating=c.yt$rating||{},c.yt$statistics=c.yt$statistics||{};var l=angular.extend({},c.gd$rating,{numLikes:~~(c.yt$rating.numLikes||0),numDislikes:~~(c.yt$rating.numDislikes||0)},{favoriteCount:~~(c.yt$statistics.favoriteCount||0),viewCount:~~(c.yt$statistics.viewCount||0)});e.push({id:g.yt$videoid.$t,title:c.title.$t.toString(),description:g.media$description?b(g.media$description.$t):"",author:{id:f.yt$userId.$t,name:f.name.$t,uri:f.uri.$t},content:c.content,contentMedia:g.media$content,duration:g.yt$duration?~~(g.yt$duration.seconds||0):0,aspectRatio:g.yt$aspectRatio?g.yt$aspectRatio.$t:null,isHD:angular.isObject(c.yt$hd),thumbnails:k,activeThumbnail:"mqdefault",comments:i,acls:d,links:c.link,ratings:l,uploaded:new Date(g.yt$uploaded.$t),published:new Date(c.published.$t),updated:new Date(c.updated.$t)})}),angular.extend({},c,{videos:e})},d=function(b,c){var d=[];return a.each(c,function(a){var b=a.yt$userId?a.yt$userId.$t:null,c=a.yt$channelId?a.yt$channelId.$t:null,e=a.author[0].yt$userId.$t,f=new Date(a.updated.$t),g=(c||b||e)+"@"+f;
d.push({id:g,author:{id:e,name:a.author[0].name.$t},type:a.category[a.category.length-1].term,link:a.link,title:a.title.$t,channelId:c,videoId:a.yt$videoid?a.yt$videoid.$t:null,userId:b,updated:new Date(f)})}),angular.extend({},b,{events:d})},e=function(b,c){var d=[];return a.each(c||[],function(a){d.push({id:a.yt$playlistId.$t,title:a.title.$t,summary:a.summary.$t,contentURL:a.content.src,links:a.link,"public":!a.yt$private,published:new Date(a.published.$t),numVideos:a.yt$countHint.$t,updated:new Date(a.updated.$t)})}),angular.extend({},b,{playlists:d})},f=function(b,c){var d=[];return a.each(c||[],function(a){var b=a.author[0];d.push({id:a.id.$t,ytuserid:b.yt$userId.$t,gplususerid:a.yt$googlePlusUserId?a.yt$googlePlusUserId.$t:null,channelid:a.yt$channelId.$t,videoid:a.yt$videoid.$t,name:b.name.$t,uri:b.uri.$t,content:a.content.$t,published:new Date(a.published.$t),updated:new Date(a.updated.$t),replies:a.yt$replyCount.$t})}),angular.extend({},b,{comments:d})};return{videoListParser:c,userEventsParser:d,playlistParser:e,commentsParser:f}}(),d=function(){var c=function(a){var c=a[0],d=c.snippet,e=c.statistics,f=c.contentDetails.relatedPlaylists;return{id:c.id,title:d.title,description:b(d.description),created:new Date(d.publishedAt),thumbnails:d.thumbnails,specialPlaylists:{favorites:f.favorites,likes:f.likes,uploads:f.uploads,watchHistory:f.watchHistory,watchLater:f.watchLater},statistics:{commentCount:~~(e.commentCount||0),hiddenSubscriberCount:!!e.hiddenSubscriberCount,subscriberCount:~~(e.subscriberCount||0),videoCount:~~(e.videoCount||0),viewCount:~~(e.viewCount||0)}}},d=function(a){var b=a[0],c=b.snippet;return{id:b.id,title:c.title,channelId:c.channelId,channelTitle:c.channelTitle,description:c.description,published:new Date(c.publishedAt),thumbnails:c.thumbnails,isPublic:b.status&&"public"===b.status.privacyStatus}},e=function(b,c,d){var e=[];return a.each(b||[],function(a){e.push({videoId:a.contentDetails.videoId,position:a.snippet.position,isPublic:"public"===a.status.privacyStatus})}),{prevPage:c,nextPage:d,items:e}},f=function(c){var d=[];return a.each(c||[],function(a){var c=a.contentDetails||{},e=a.snippet||{},f=a.statistics||{},g=a.status||{};d.push({id:a.id,channelId:e.channelId,channelTitle:e.channelTitle,title:e.title,description:b(e.description),caption:!!c.caption,definition:c.definition,dimension:c.dimension,licensedContent:c.licensedContent,categoryId:~~(e.categoryId||0),publishedAt:e.publishedAt?new Date(e.publishedAt):null,thumbnails:e.thumbnails,comments:~~(f.commentCount||0),dislikes:~~(f.dislikeCount||0),favorites:~~(f.favoriteCount||0),likes:~~(f.likeCount||0),views:~~(f.viewCount||0),embeddable:!!g.embeddable,license:g.license,"public":"public"===g.privacyStatus,viewable:!!g.publicStatsViewable})}),d};return{channelParser:c,playlistParser:d,playlistItemParser:e,videoListParser:f}}()}]),angular.module("newtube.directives.app-link",[]).directive("channelLink",[function(){"use strict";return{restrict:"EA",scope:{id:"="},transclude:!0,template:'<a href="#/channel/{{id}}" ng-transclude></a>'}}]).directive("playlistLink",[function(){"use strict";return{restrict:"EA",scope:{id:"="},transclude:!0,template:'<a ng-show="id" href="#/playlist/{{id}}" ng-transclude></a>'}}]).directive("videoLink",[function(){"use strict";return{restrict:"EA",scope:{id:"="},transclude:!0,template:'<a href="#/video/{{id}}" ng-transclude></a>'}}]),angular.module("newtube.directives.comments",["newtube.plugins.d3"]).directive("comments",["D3",function(a){"use strict";var b,c={top:30,right:20,bottom:30,left:20},d=960-c.left-c.right,e=20,f=.8*d,g=0,h=400,i=a.layout.tree().size([0,100]);a.svg.diagonal().projection(function(a){return[a.y,a.x]});var j=function(a){return a._children?"#3182bd":a.children?"#c6dbef":"#fd8d3c"},k=function(b,d){var k=i.nodes(b),m=Math.max(500,k.length*e+c.top+c.bottom);a.select("svg").attr("height",m),a.select(this.frameElement).style("height",m+"px"),k.forEach(function(a,b){a.x=b*e});var n=d.selectAll("g.node").data(k,function(a){return a.id||(a.id=++g)}),o=n.enter().append("g").attr("class","node").attr("transform",function(){return"translate("+b.y0+","+b.x0+")"}).style("opacity",1e-6);o.append("rect").attr("y",-e/2).attr("height",e).attr("width",f).style("fill",j).on("click",function(a){l(a,d)}),o.append("text").attr("dy",3.5).attr("dx",5.5).text(function(a){return a.name}),o.transition().duration(h).attr("transform",function(a){return"translate("+a.y+","+a.x+")"}).style("opacity",1),n.transition().duration(h).attr("transform",function(a){return"translate("+a.y+","+a.x+")"}).style("opacity",1).select("rect").style("fill",j),n.exit().transition().duration(h).attr("transform",function(){return"translate("+b.y+","+b.x+")"}).style("opacity",1e-6).remove(),k.forEach(function(a){a.x0=a.x,a.y0=a.y})},l=function(a,b){a.children?(a._children=a.children,a.children=null):(a.children=a._children,a._children=null),k(a,b)};return{restrict:"EA",scope:{val:"="},link:function(e,f){var g=a.select(f[0]).append("svg").attr("width",d+c.left+c.right).append("g").attr("transform","translate("+c.left+","+c.top+")");e.$watch("val",function(a,c){return a&&a.length?(a!==c&&(b={x0:0,y0:0,children:a},k(b,g)),void 0):(c&&g.selectAll("*").remove(),void 0)})}}}]),angular.module("newtube.directives.textbox",["newtube.plugins.tip"]).directive("textbox",["tip",function(a){"use strict";return{restrict:"EAC",link:function(b,c,d){var e=b.$eval(d.textbox),f=a(c,e);return b.$on("$destroy",function(){f.remove()}),f.show()}}}]),angular.module("newtube.directives.user-info",["newtube.directives.app-link"]).directive("userInfo",[function(){"use strict";return{restrict:"EA",scope:{user:"="},templateUrl:"templates/user-info.html"}}]),angular.module("newtube.directives.video",["newtube.directives.video-player","newtube.directives.app-link","newtube.plugins.owl-carousel","newtube.plugins.lodash","wu.masonry","angular-carousel"]).controller("videoListController",["_","$scope","$timeout",function(a,b,c){"use strict";var d=function(c){return c&&b.videos?a.findIndex(b.videos,{id:c}):-1};b.activeId=null,b.playingId=null,b.playingVideo=null,b.unsetActiveVideo=function(){b.activeId=null},b.$watch("playingId",function(){c(function(){b.playingVideo=b.playingId?(a.where(b.videos,{id:b.playingId})||[])[0]:null})}),this.getNextId=function(){if(!b.videos||!b.videos.length)return null;for(var a,c=d(b.playingId||b.activeId);(!a||!a.content)&&c<b.videos.length;)c+=1,a=b.videos[c];return c>=b.videos.length&&(a=b.videos[0]),a.id},this.setActiveVideoId=function(a){b.activeId=a},this.getActiveVideoId=function(){return b.activeId},this.setPlayingVideoId=function(a){b.playingId=a},this.getPlayingVideoId=function(){return b.playingId},this.getVideoThumbnail=function(a){if(!a)return"";var b=a.thumbnails?a.thumbnails[a.activeThumbnail||"mqdefault"]:null;return b?b.url:null},this.repaint=function(){b.videos.push({}),c(function(){b.videos.pop()})}}]).directive("videoGrid",[function(){"use strict";return{restrict:"EA",scope:{videos:"="},controller:"videoListController",templateUrl:"templates/video-grid.html"}}]).directive("videoCarousel",["$timeout","owl-carousel",function(a,b){"use strict";return{restrict:"EA",scope:{videos:"="},controller:"videoListController",templateUrl:"templates/video-carousel.html",link:function(c,d,e,f){c.playNext=function(b){a(function(){f.setPlayingVideoId(b||f.getNextId())})},c.$watch("videos",function(a,e){!e&&a&&c.playNext(),a&&a.length&&b(d.find(".owl-carousel"),{itemsCustom:[[0,1],[360,1],[700,3],[1100,4]],navigation:!0,paginationNumbers:!0,lazyLoad:!0,addClassActive:!0})})}}}]).directive("videoGridItem",[function(){"use strict";var a=function(a){return a&&a.id?a.id||"":""};return{restrict:"EA",require:"^videoGrid",scope:{video:"="},templateUrl:"templates/video.html",link:function(b,c,d,e){b.activeVideo=!1,b.$watch(e.getActiveVideoId,function(c){b.activeVideo=c===a(b.video),b.hasActive=null!==c}),b.setActive=function(){e.setActiveVideoId(a(b.video))},b.highlightVideo=function(){b.video.activeThumbnail=b.activeVideo&&"mqdefault"===(b.video.activeThumbnail||"mqdefault")?"hqdefault":"mqdefault",e.repaint()},b.getVideoThumbnail=function(){return e.getVideoThumbnail(b.video)},c.on("click",b.highlightVideo),c.on("mouseenter",b.setActive)}}}]).directive("videoCarouselItem",[function(){"use strict";var a=function(a){return a&&a.id?a.id||"":""};return{restrict:"EA",require:"^videoCarousel",scope:{video:"="},templateUrl:"templates/video.html",link:function(b,c,d,e){b.activeVideo=!1,b.playingVideo=!1,b.$watch(function(){return e.getActiveVideoId()},function(c){b.activeVideo=c===a(b.video),b.hasActive=null!==c}),b.$watch(function(){return e.getPlayingVideoId()},function(c){b.playingVideo=c===a(b.video)}),b.setActive=function(){e.setActiveVideoId(a(b.video))},b.highlightVideo=function(){b.video.activeThumbnail=b.activeVideo&&"mqdefault"===(b.video.activeThumbnail||"mqdefault")?"hqdefault":"mqdefault",e.repaint()},b.getVideoThumbnail=function(){return e.getVideoThumbnail(b.video)}}}}]),angular.module("newtube.directives.video-player",["newtube.plugins.lodash","newtube.plugins.videojs-youtube"]).directive("videoPlayer",["_","videojs-youtube",function(a,b){"use strict";var c={index:3,format:"16:9",dimensions:[{w:1280,h:720,f:"16:9",i:1,xf:2},{w:1024,h:768,f:"4:3",i:2,xf:1},{w:768,h:432,f:"16:9",i:3,xf:4},{w:640,h:480,f:"4:3",i:4,xf:5},{w:640,h:360,f:"16:9",i:5,xf:4},{w:512,h:384,f:"4:3",i:6,xf:7},{w:512,h:288,f:"16:9",i:7,xf:6},{w:320,h:240,f:"4:3",i:8,xf:9},{w:320,h:180,f:"16:9",i:9,xf:8},{w:256,h:144,f:"16:9",i:10,xf:8}],filter:function(){var b=a.where(this.dimensions,{f:this.format});return b.length?b:this.dimensions},changeFormat:function(){this.format="16:9"===this.format?"4:3":"16:9",this.index=this.get().xf},get:function(){return a.first(a.where(this.dimensions,{i:this.index}))},larger:function(){var b=this.filter(),c=this.index,d=a.max(a.where(b,function(a){return a.i<c}),"i");d&&d.i>=0&&(this.index=d.i)},smaller:function(){var b=this.filter(),c=this.index,d=a.min(a.where(b,function(a){return a.i>c}),"i");d&&d.i&&(this.index=d.i)}};return{restrict:"EA",scope:{videoId:"=",format:"=",onEnd:"&"},templateUrl:"templates/video-player.html",link:function(a,d){var e=function(){a.player&&(a.player.dispose(),a.player=null)},f=function(){if(a.player){var b=c.get();a.player.width(b.w),a.player.height(b.h)}},g=function(){a.player&&a.videoId&&a.player.src("https://www.youtube.com/watch?v="+a.videoId)},h=function(){var b=a.format&&"4:3"!==a.format?"16:9":"4:3";b!==c.format&&(c.changeFormat(),f())};a.smaller=function(){c.smaller(),f()},a.larger=function(){c.larger(),f()},a.$on("$destroy",function(){e()}),a.$watch("format",h),a.$watch("videoId",function(c,h){if(!c)return e(),void 0;if(c!==h){var i=d.find(".videocontainer");i.attr("id",c),a.player?g():b(i,{autoplay:!0,techOrder:["youtube"],ytcontrols:!0}).ready(function(){a.player=this,a.player.on("firstplay",angular.noop),a.player.on("play",angular.noop),a.player.on("pause",angular.noop),a.player.on("progress",angular.noop),a.player.on("error",angular.noop),a.player.on("ended",a.onEnd||angular.noop),g(),f()})}})}}}]),angular.module("newtube.filters",["newtube.plugins.moment"]).filter("timeago",["moment",function(a){"use strict";return function(b){if(!b)return"";var c=a(b);return c.isValid()?c.fromNow():void 0}}]).filter("duration",["moment",function(a){"use strict";return function(b){if(!b)return"";var c=a(1e3*b),d=!!c.hours();return c.format(d?"H:mm:ss":"m:ss")}}]).filter("html",[function(){"use strict"}]);